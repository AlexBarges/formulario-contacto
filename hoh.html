<!DOCTYPE html>
<html lang="pt-BR" style="--accent: #8a8a8a; --hdr-scale: 1;"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HALLS OF HEROES</title>
  <style>
    :root{
      --bg:#000;--fg:#ddd;--accent:#888;--gap:10px;
      --radius:14px;--panel-w:360px;--menu-w:220px;--shadow:0 6px 20px rgba(0,0,0,.45);
      --cell-font: 12px; --dot-size: 16px;
      --hdr-scale: 1;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:#000;color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;line-height:1.4;display:flex;min-height:100vh}
    .layout{display:grid;grid-template-columns:var(--menu-w) 1fr var(--panel-w);grid-template-rows:auto 1fr auto;width:100%;min-height:100vh}
    .menu{grid-row:1 / span 3;grid-column:1;border-right:1px solid #222;padding:12px;background:#050505;position:sticky;top:0;height:100vh;overflow:auto}
    .brand{font-weight:700;letter-spacing:.08em;font-size:clamp(11px, 1.2vw, 14px);color:#9a9a9a;margin:6px 0 10px;text-transform:uppercase}
    .menu button{width:100%;display:block;margin:8px 0;padding:12px 10px;background:#0b0b0b;border:2px solid var(--accent);color:var(--fg);border-radius:12px;cursor:pointer;transition:.2s ease;text-align:left;font-weight:700;letter-spacing:.02em;text-transform:uppercase;box-shadow:var(--shadow);font-size:clamp(11px,1.5vw,15px)}
    .menu button.active{transform:translateX(3px);background:#101010;box-shadow:0 0 0 2px var(--accent),var(--shadow)}
    header{grid-column:2;grid-row:1;padding:10px 14px;border-bottom:1px solid #222;display:flex;align-items:center;justify-content:space-between;gap:14px;position:sticky;top:0;background:#000;z-index:5;white-space:nowrap}
    h1{margin:0;font-size:clamp(18px, 2.2vw, 28px);letter-spacing:.08em;text-transform:uppercase;transform-origin:left center;transform:scale(var(--hdr-scale))}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:nowrap;transform-origin:right center;transform:scale(var(--hdr-scale));}
    .btn{padding:clamp(6px,0.6vw,10px) clamp(10px,1vw,14px);border-radius:12px;border:2px solid var(--accent);background:#0b0b0b;color:var(--fg);font-weight:800;text-transform:uppercase;letter-spacing:.04em;cursor:pointer;transition:.15s ease;box-shadow:var(--shadow);font-size:clamp(10px,1.2vw,14px)}
    .btn:hover{transform:translateY(-1px)} .btn[aria-pressed="true"]{box-shadow:0 0 0 2px var(--accent),var(--shadow);background:#101010}
    .grid-wrap{grid-column:2;grid-row:2;padding:18px;overflow:hidden auto;scrollbar-width:none}
    .grid-wrap::-webkit-scrollbar{display:none}
    .grid{display:grid;grid-template-columns:repeat(6, minmax(0, 1fr));gap:var(--gap);}
    .cell{width:100%;aspect-ratio:1/1;background:#0e0e0e;border:2px dashed var(--accent);border-radius:14px;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;user-select:none;transition:border-color .15s ease,background .15s ease;font-size:var(--cell-font)}
    .cell img{max-width:100%;max-height:100%;object-fit:cover;display:block}
    .cell .overlay{position:absolute;inset:0;background:transparent;pointer-events:none}
    .cell .toolbar{position:absolute;right:6px;top:6px;display:flex;gap:calc(var(--cell-font)*0.35);z-index:3}
    .dot{width:var(--dot-size);height:var(--dot-size);border-radius:50%;border:none;cursor:pointer;box-shadow:var(--shadow);opacity:.95;display:inline-block;flex:0 0 auto}
    .dot:focus{outline:2px solid #fff50a;outline-offset:2px}
    .dot-url{background:#9aa0a6}
    .dot-info{background:#8b5e3c}
    @media (hover:hover){ .dot:hover{transform:scale(1.07)} }
    .cell .hint{position:absolute;bottom:8px;left:0;right:0;text-align:center;font-size:calc(var(--cell-font)*0.85);color:#888;pointer-events:none}
    .side{grid-column:3;grid-row:1 / span 3;border-left:1px solid #222;padding:16px;position:sticky;top:0;height:100vh;overflow:auto;background:#050505}
    .card{border:1px solid var(--accent);border-radius:16px;padding:14px;background:#0a0a0a;box-shadow:var(--shadow)}
    .big{width:100%;aspect-ratio:1/1;background:#0e0e0e;border:1px dashed var(--accent);border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden;margin-bottom:12px}
    .big img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .meta dt{color:#aaa;font-size:12px;text-transform:uppercase;letter-spacing:.08em}
    .meta dd{margin:2px 0 10px;font-weight:600}
    .toast{position:fixed;bottom:16px;left:calc(var(--menu-w) + 16px);right:calc(var(--panel-w) + 16px);background:#0b0b0b;border:2px solid var(--accent);border-radius:12px;padding:10px 14px;text-align:center;z-index:50;display:none;box-shadow:var(--shadow)}
    .footer{grid-column:2;grid-row:3;padding:12px 18px;border-top:1px solid #222;display:flex;gap:10px;align-items:center;justify-content:flex-end;background:#000;position:sticky;bottom:0;z-index:5}
    .legend{margin-right:auto;font-size:12px;color:#aaa}
    dialog{border:1px solid var(--accent);border-radius:16px;background:#0a0a0a;color:#fff;padding:16px;width:min(760px,96vw)}
    dialog input, dialog textarea{width:100%;padding:10px;margin:6px 0 12px;border-radius:10px;border:1px solid #333;background:#0f0f0f;color:#ddd}
    dialog .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    dialog .actions{display:flex;gap:10px;justify-content:flex-end}
    .theme-FOGO{--accent:#f04444}.theme-ÁGUA{--accent:#2e7df6}.theme-VENTO{--accent:#f5d13d}.theme-LUZ{--accent:#f1f1f1;--fg:#f1f1f1}.theme-ESCURIDÃO{--accent:#8a8a8a}
    .theme-LUZ .btn, .theme-LUZ .menu button{color:#111;background:#f1f1f1;border-color:#cfcfcf}
    .theme-LUZ header, .theme-LUZ .menu, .theme-LUZ .side, .theme-LUZ .footer, .theme-LUZ body{background:#000;color:#fff}
    .theme-LUZ .cell{border-color:#cfcfcf}
    .dragging{cursor:grabbing}
    .muted{color:#9aa0a6;font-size:12px}
  </style>
</head>
<body>
  <div class="layout theme-ESCURIDÃO" id="app" style="--cell-font: 12px; --dot-size: 15px;">
    <nav class="menu" id="menu"><div class="brand">HALLS OF HEROES</div><button data-key="FOGO" class="">FOGO</button><button data-key="ÁGUA" class="">ÁGUA</button><button data-key="VENTO" class="">VENTO</button><button data-key="LUZ" class="">LUZ</button><button data-key="ESCURIDÃO" class="active">ESCURIDÃO</button></nav>
    <header>
      <h1 id="title">ESCURIDÃO</h1>
      <div class="actions">
        <button id="btnDelete" class="btn" aria-pressed="false">Apagar</button>
        <button id="btnExport" class="btn">Exportar</button>
        <button id="btnImport" class="btn">Importar</button>
        <input id="importInput" type="file" accept="application/json" style="display:none">
        <button id="btnSave" class="btn">Salvar</button>
      </div>
    </header>
    <main class="grid-wrap" id="gridWrap">
      <div class="grid" id="grid" role="grid" aria-label="Grade dinâmica de imagens" style="--accent: #8a8a8a;"><div class="cell" data-index="0"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Nine-tailed_Fox_Dark_Icon.png"></div><div class="cell" data-index="1"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Undine_Dark_Icon.png"></div><div class="cell" data-index="2"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Sylph_Dark_Icon.png"></div><div class="cell" data-index="3"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Sylphid_Dark_Icon.png"></div><div class="cell" data-index="4"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Succubus_Dark_Icon.png"></div><div class="cell" data-index="5"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Joker_Dark_Icon.png"></div><div class="cell" data-index="6"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Pierret_Dark_Icon.png"></div><div class="cell" data-index="7"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Phantom_Thief_Dark_Icon.png"></div><div class="cell" data-index="8"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Magical_Archer_Dark_Icon.png"></div><div class="cell" data-index="9"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Rakshasa_Dark_Icon.png"></div><div class="cell" data-index="10"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Death_Knight_Dark_Icon.png"></div><div class="cell" data-index="11"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Lich_Dark_Icon.png"></div><div class="cell" data-index="12"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Samurai-Dark.png"></div><div class="cell" data-index="13"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Kung-Fu-Girl-Dark.png"></div><div class="cell" data-index="14"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Brownie-Magician-Dark.png"></div><div class="cell" data-index="15"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Kobold-Bomber-Dark.png"></div><div class="cell" data-index="16"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Barbaric-King-Dark.png"></div><div class="cell" data-index="17"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Pirate-Captain-Dark.png"></div><div class="cell" data-index="18"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Mermaid-Dark.png"></div><div class="cell" data-index="19"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Magic-Knight-Dark.png"></div><div class="cell" data-index="20"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Assassin-Dark.png"></div><div class="cell" data-index="21"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Neostone-Fighter-Dark.png"></div><div class="cell" data-index="22"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Horus-Dark.png"></div><div class="cell" data-index="23"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Jack-o-lantern_Dark_Icon.png"></div><div class="cell" data-index="24"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Elven-Ranger-Dark.png"></div><div class="cell" data-index="25"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Dice_Magician_Dark_Icon.png"></div><div class="cell" data-index="26"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-chakram-dancer.png"></div><div class="cell" data-index="27"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-boomerang-warrior.png"></div><div class="cell" data-index="28"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Dryad_Dark_Icon.png"></div><div class="cell" data-index="29"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/Giant_Warror_Dark_Icon.png"></div><div class="cell" data-index="30"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-sniper-mk-i.png"></div><div class="cell" data-index="31"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-gargoyle.png"></div><div class="cell" data-index="32"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-string-master.png"></div><div class="cell" data-index="33"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-poison-master.png"></div><div class="cell" data-index="34"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-blade-dancer.png"></div><div class="cell" data-index="35"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0077_0_5.png"></div><div class="cell" data-index="36"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0081_0_5.png"></div><div class="cell" data-index="37"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0085_0_5.png"></div><div class="cell" data-index="38"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0100_0_5.png"></div><div class="cell" data-index="39"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0098_0_5.png"></div><div class="cell" data-index="40"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0114_0_5.png"></div><div class="cell" data-index="41"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0119_0_5.png"></div><div class="cell" data-index="42"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay" style="background: rgba(0, 0, 0, 0.8);"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0132_0_5.png"></div><div class="cell" data-index="43"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0151_0_5_fiona.png"></div><div class="cell" data-index="44"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0145_0_5.png"></div><div class="cell" data-index="45"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0176_0_5_volg.png"></div><div class="cell" data-index="46"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0164_1_5_yuko.png"></div><div class="cell" data-index="47"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0179_1_1_Azure-Dragon-SwordsmanD.png"></div><div class="cell" data-index="48"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint" style="display: none;">Adicionar</div><img loading="lazy" referrerpolicy="no-referrer" alt="Imagem" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/unit_icon_0182_1_1_White-Tiger-Blade-MasterD.png"></div><div class="cell" data-index="49"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint">Adicionar</div></div><div class="cell" data-index="50"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint">Adicionar</div></div><div class="cell" data-index="51"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint">Adicionar</div></div><div class="cell" data-index="52"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint">Adicionar</div></div><div class="cell" data-index="53"><div class="toolbar"><button type="button" class="dot dot-url" title="URL"></button><button type="button" class="dot dot-info" title="Info"></button></div><div class="overlay"></div><div class="hint">Adicionar</div></div></div>
    </main>
    <aside class="side">
      <div class="card">
        <div class="big" id="previewBig"><img loading="lazy" referrerpolicy="no-referrer" src="https://raw.githubusercontent.com/AlexBarges/mellamollama/main/site/halls-images/escuridao/dark-poison-master.png"></div>
        <dl class="meta" id="meta">
          <dt>Nome</dt><dd id="m-nome">—</dd>
          <dt>Propriedade</dt><dd id="m-propriedade">—</dd>
          <dt>Classe</dt><dd id="m-classe">—</dd>
          <dt>Notas</dt><dd id="m-notas">—</dd>
        </dl>
      </div>
      <p class="muted">Arraste verticalmente em uma área sem células para rolar. Sempre 6 células por linha. Exportar/Importar permitem manter seus dados.</p>
    </aside>
    <div class="footer">
      <span class="legend">Salvamento automático ativo. “Exportar” baixa JSON + HTML portátil.</span>
    </div>
    <div class="toast" id="toast" style="display: none;">Salvo.</div>
  </div>

  <!-- Estado embutido: será preenchido ao exportar -->
  <script id="embedded-state" type="application/json">{"pages":{}}</script>

  <dialog id="infoDialog">
    <form method="dialog" id="infoForm">
      <h3 style="margin:0 0 10px;letter-spacing:.06em;text-transform:uppercase">Ficha do personagem</h3>
      <div class="row">
        <div><label>Nome</label><input type="text" name="nome" placeholder="Ex.: Killa"></div>
        <div><label>Classe</label><input type="text" name="classe" placeholder="Ex.: Guardião"></div>
      </div>
      <div class="row">
        <div><label>Propriedade</label><input type="text" name="propriedade" placeholder="Ex.: Amuleto solar"></div>
        <div><label>Notas</label><input type="text" name="notas" placeholder="Observações breves"></div>
      </div>
      <div class="row">
        <div><label>Imagem da célula (URL ou nome do arquivo)</label><input type="text" id="cellUrl" placeholder="https://... ou arquivo.png"></div>
        <div><label>Imagem do painel direito (URL ou nome do arquivo)</label><input type="text" id="detailUrl" placeholder="https://... ou arquivo.png"></div>
      </div>
      <div class="actions">
        <button class="btn" value="cancel">Cancelar</button>
        <button class="btn" id="saveInfoBtn" value="default">Salvar ficha</button>
      </div>
    </form>
  </dialog>

  <script>
  (function(){
    // ====== CONFIG ======
    var ELEMENTS = [
      { key:'FOGO',        folder:'fogo',       color:'rgba(240,68,68,0.80)' , accent:'#f04444' },
      { key:'ÁGUA',        folder:'agua',       color:'rgba(46,125,246,0.80)', accent:'#2e7df6' },
      { key:'VENTO',       folder:'vento',      color:'rgba(245,209,61,0.80)', accent:'#f5d13d' },
      { key:'LUZ',         folder:'luz',        color:'rgba(241,241,241,0.80)', accent:'#f1f1f1' },
      { key:'ESCURIDÃO',   folder:'escuridao',  color:'rgba(0,0,0,0.80)', accent:'#8a8a8a' },
    ];
    var ORDER = ['ESCURIDÃO','VENTO','ÁGUA','FOGO','LUZ'];
    var STORAGE_KEY = 'halls-of-heroes-v17-4';
    var INITIAL_ROWS = 3;
    var COLS = 6;
    var RAW = { user:'AlexBarges', repo:'mellamollama', branch:'main', root:'site/halls-images' };

    // ====== DOM ======
    var app = document.getElementById('app');
    var gridWrap = document.getElementById('gridWrap');
    var grid = document.getElementById('grid');
    var title = document.getElementById('title');
    var menu = document.getElementById('menu');
    var btnDelete = document.getElementById('btnDelete');
    var btnSave = document.getElementById('btnSave');
    var btnExport = document.getElementById('btnExport');
    var btnImport = document.getElementById('btnImport');
    var importInput = document.getElementById('importInput');
    var toast = document.getElementById('toast');
    var previewBig = document.getElementById('previewBig');
    var mNome = document.getElementById('m-nome');
    var mPropriedade = document.getElementById('m-propriedade');
    var mClasse = document.getElementById('m-classe');
    var mNotas = document.getElementById('m-notas');
    var infoDialog = document.getElementById('infoDialog');
    var infoForm = document.getElementById('infoForm');
    var cellUrl = document.getElementById('cellUrl');
    var detailUrl = document.getElementById('detailUrl');
    var embeddedTag = document.getElementById('embedded-state');

    // ====== STATE ======
    var state = loadEmbeddedState() || migrate(loadRawState());
    var current = pickInitialPage();
    var deleteMode = false;
    var dirty = false;
    var saveTimer = null;

    // ====== INIT ======
    cleanupLegacyKeys();
    ensurePage(current);
    buildMenu();
    render(current);
    updateScale();
    new ResizeObserver(updateScale).observe(document.querySelector('.grid'));

    // ====== Header numa linha (auto-escala) ======
    function fitHeader(){
      var container = document.querySelector('header');
      var actions = document.querySelector('.actions');
      var titleEl = document.getElementById('title');
      document.documentElement.style.setProperty('--hdr-scale','1');
      var needed = titleEl.getBoundingClientRect().width + actions.getBoundingClientRect().width + 24;
      var available = container.getBoundingClientRect().width;
      if(needed > available){
        var scale = Math.max(0.6, available / needed);
        document.documentElement.style.setProperty('--hdr-scale', String(scale));
      }
    }
    new ResizeObserver(fitHeader).observe(document.querySelector('header'));
    window.addEventListener('load', fitHeader);

    // ====== Drag-to-scroll vertical ======
    var dragging = false, startY = 0, startScroll = 0;
    gridWrap.addEventListener('pointerdown', function(e){
      if(e.target.closest('.cell')) return;
      dragging = true;
      startY = e.clientY;
      startScroll = gridWrap.scrollTop;
      gridWrap.classList.add('dragging');
      gridWrap.setPointerCapture(e.pointerId);
      e.preventDefault();
    });
    gridWrap.addEventListener('pointermove', function(e){
      if(!dragging) return;
      var dy = e.clientY - startY;
      gridWrap.scrollTop = startScroll - dy;
    });
    function endDrag(e){ if(!dragging) return; dragging = false; gridWrap.classList.remove('dragging'); try{ gridWrap.releasePointerCapture(e.pointerId); }catch(_){} }
    gridWrap.addEventListener('pointerup', endDrag);
    gridWrap.addEventListener('pointercancel', endDrag);
    gridWrap.addEventListener('pointerleave', endDrag);

    // ====== Helpers ======
    function elementInfo(key){ for(var i=0;i<ELEMENTS.length;i++){ if(ELEMENTS[i].key===key) return ELEMENTS[i]; } return ELEMENTS[0]; }
    function rawBaseFor(key){ var el = elementInfo(key); return 'https://raw.githubusercontent.com/'+RAW.user+'/'+RAW.repo+'/'+RAW.branch+'/'+RAW.root+'/'+el.folder; }
    function isFilename(v){ return v && v.indexOf('://')===-1 && v.indexOf('data:')!==0 && v.indexOf('blob:')!==0; }
    function buildURL(input, pageKey){
      if(!input) return '';
      if(isFilename(input)) return rawBaseFor(pageKey)+'/'+input;
      try{
        var url = new URL(input);
        if(url.hostname.indexOf('drive.google.com')>-1){
          var parts = url.pathname.split('/'); var idx = parts.indexOf('d');
          if(parts.indexOf('file')>-1 && idx>=0 && parts[idx+1]){ var id = parts[idx+1]; return 'https://drive.google.com/uc?export=view&id='+id; }
          if(url.searchParams.get('id')){ return 'https://drive.google.com/uc?export=view&id='+url.searchParams.get('id'); }
        }
        if(url.hostname.indexOf('dropbox.com')>-1){ url.searchParams.set('dl','1'); return url.toString(); }
      }catch(_){}
      return input;
    }
    function showToast(msg){ toast.textContent = msg; toast.style.display='block'; setTimeout(function(){ toast.style.display='none'; }, 1400); }
    function markDirty(){ dirty = true; scheduleCommit(); }
    function scheduleCommit(){ if(saveTimer) clearTimeout(saveTimer); saveTimer = setTimeout(function(){ commit(true); }, 250); }

    function trimTrailingEmptyRows(page){
      var used = Object.keys(page.cells).map(function(i){return parseInt(i,10);}).filter(function(n){return !isNaN(n);});
      if(used.length===0){ page.rows = INITIAL_ROWS; return; }
      var maxIdx = Math.max.apply(Math, used);
      var minRows = Math.max(INITIAL_ROWS, Math.ceil((maxIdx+1)/COLS));
      page.rows = minRows;
    }
    function compactState(s){
      var n = { pages:{} };
      for(var k in (s.pages||{})){
        var p = s.pages[k];
        var clone = { rows: p.rows||INITIAL_ROWS, cells: {} };
        for(var idx in (p.cells||{})){
          var data = p.cells[idx];
          if(data && (data.imgURL || data.detailURL || data.nome || data.classe || data.propriedade || data.notas || data.tint)){
            clone.cells[idx] = data;
          }
        }
        trimTrailingEmptyRows(clone);
        n.pages[k] = clone;
      }
      return n;
    }
    function autoExpandIfFilled(pageKey){
      var page = state.pages[pageKey];
      var capacity = page.rows * COLS;
      var filled = 0;
      for (var idx in (page.cells||{})) {
        var i = parseInt(idx, 10);
        var data = page.cells[idx];
        if (!isNaN(i) && i < capacity && data && (data.imgURL || data.detailURL)) filled++;
      }
      if (filled >= capacity) { page.rows += 1; markDirty(); }
    }

    function commit(show){
      if(typeof show==='undefined') show = true;
      try{
        var compact = compactState(state);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(compact));
        dirty = false;
        if(show) showToast('Salvo.');
      }catch(e){
        console.error(e);
        alert('Falha ao salvar: ' + (e && e.message ? e.message : 'Quota excedida'));
      }
    }
    setInterval(function(){ if(dirty) commit(false); }, 5000);
    document.addEventListener('visibilitychange', function(){ if(document.hidden && dirty) commit(false); });
    window.addEventListener('beforeunload', function(){ if(dirty) commit(false); });

    function loadRawState(){ try{ var raw = localStorage.getItem(STORAGE_KEY); if(raw) return JSON.parse(raw); }catch(e){} return { pages:{} }; }
    function loadEmbeddedState(){
      try{
        if(!embeddedTag) return null;
        var txt = embeddedTag.textContent;
        if(!txt) return null;
        txt = txt.replace(/^\s+|\s+$/g,'');
        if(!txt) return null;
        var json = JSON.parse(txt);
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(json)); }catch(e){}
        return json;
      }catch(e){ return null; }
    }
    function migrate(s){
      for(var pk in (s.pages||{})){
        var p = s.pages[pk];
        if(Array.isArray(p.cells)){
          var map = {}; for(var i=0;i<p.cells.length;i++){ if(p.cells[i]) map[i]=p.cells[i]; }
          p.cells = map;
        }
      }
      return s;
    }
    function cleanupLegacyKeys(){
      var keys = Object.keys(localStorage);
      for(var i=0;i<keys.length;i++){
        var k = keys[i];
        if(/^halls-of-heroes-v(0?[8-9]|1[0-7](\.[0-9]+)?)$/.test(k)){
          try{ localStorage.removeItem(k); }catch(e){}
        }
      }
    }

    function pickInitialPage(){
      var baseline = new Date(Date.UTC(2025,8,1)); // set/2025 = ESCURIDÃO
      var now = new Date();
      var months = (now.getFullYear()-baseline.getUTCFullYear())*12 + (now.getMonth()-8);
      if(isNaN(months)) months = 0;
      months = Math.max(0, months);
      var idx = ((months % ORDER.length) + ORDER.length) % ORDER.length;
      return ORDER[idx];
    }
    function ensurePage(key){ if(!state.pages[key]) state.pages[key] = { rows: INITIAL_ROWS, cells: {} }; }
    function setTheme(key){
      document.getElementById('app').className = 'layout theme-'+key;
      document.documentElement.style.setProperty('--accent', elementInfo(key).accent);
    }

    function buildMenu(){
      var frag = document.createDocumentFragment();
      var brand = document.createElement('div'); brand.className='brand'; brand.textContent='HALLS OF HEROES'; frag.appendChild(brand);
      for(var i=0;i<ELEMENTS.length;i++){
        var el = ELEMENTS[i];
        var btn = document.createElement('button');
        btn.textContent = el.key; btn.dataset.key = el.key; btn.className = (el.key===current) ? 'active' : '';
        btn.onclick = (function(k){ return function(){ current = k; ensurePage(current); render(current); markDirty(); }; })(el.key);
        frag.appendChild(btn);
      }
      menu.innerHTML=''; menu.appendChild(frag);
    }

    function render(pageKey){
      setTheme(pageKey); title.textContent = pageKey;
      var buttons = menu.querySelectorAll('button');
      for(var b=0;b<buttons.length;b++){ var btn = buttons[b]; btn.classList.toggle('active', btn.dataset.key===pageKey); }
      var page = state.pages[pageKey]; grid.innerHTML=''; grid.style.setProperty('--accent', elementInfo(pageKey).accent);

      var total = page.rows*COLS;
      for(var i=0;i<total;i++){
        var cell = document.createElement('div'); cell.className='cell'; cell.dataset.index=i;
        var tb = document.createElement('div'); tb.className='toolbar';
        var urlBtn = document.createElement('button'); urlBtn.type='button'; urlBtn.className='dot dot-url'; urlBtn.title='URL';
        urlBtn.addEventListener('click', (function(pk, idx){ return function(ev){ ev.stopPropagation(); addUrlToCell(pk, idx); }; })(pageKey, i));
        var infoBtn = document.createElement('button'); infoBtn.type='button'; infoBtn.className='dot dot-info'; infoBtn.title='Info';
        infoBtn.addEventListener('click', (function(pk, idx){ return function(ev){ ev.stopPropagation(); openInfoDialog(pk, idx); }; })(pageKey, i));
        tb.appendChild(urlBtn); tb.appendChild(infoBtn); cell.appendChild(tb);

        var overlay = document.createElement('div'); overlay.className='overlay'; cell.appendChild(overlay);
        var hint = document.createElement('div'); hint.className='hint'; hint.textContent='Adicionar'; cell.appendChild(hint);

        var data = page.cells[i];
        if(data && data.imgURL){
          hint.style.display='none';
          var imgEl = new Image(); imgEl.loading='lazy'; imgEl.referrerPolicy='no-referrer'; imgEl.alt = data.nome || 'Imagem'; cell.appendChild(imgEl);
          imgEl.src = data.imgURL;
          if(data.tint) overlay.style.background = elementInfo(pageKey).color;
        }

        cell.addEventListener('mouseenter', (function(pk, idx){ return function(){ showPreview(pk, idx); }; })(pageKey, i));
        cell.addEventListener('focus', (function(pk, idx){ return function(){ showPreview(pk, idx); }; })(pageKey, i));
        cell.addEventListener('click', (function(pk, idx){ return function(){
          if(deleteMode){ clearCell(pk, idx); render(pk); commit(true); }
          else{ toggleOverlay(pk, idx); render(pk); commit(true); }
        }; })(pageKey, i));

        grid.appendChild(cell);
      }
      updateScale();
      fitHeader();
    }

    function addUrlToCell(pageKey, index){
      var raw = prompt('Cole a URL da imagem ou apenas o NOME DO ARQUIVO (ex.: undine_dark_icon.png):');
      if(!raw) return;
      var url = buildURL(raw.trim(), pageKey);
      var page = state.pages[pageKey];
      page.cells[index] = page.cells[index] || {};
      page.cells[index].imgURL = url;
      if(!page.cells[index].detailURL) page.cells[index].detailURL = url;

      autoExpandIfFilled(pageKey);

      markDirty(); render(pageKey); commit(true);
    }

    function clearCell(pageKey, index){ var page = state.pages[pageKey]; delete page.cells[index]; updateSidePanel(null); markDirty(); }
    function toggleOverlay(pageKey, index){ var page = state.pages[pageKey]; if(!page.cells[index]) return; page.cells[index].tint = !page.cells[index].tint; markDirty(); }

    function showPreview(pageKey, index){
      var page = state.pages[pageKey];
      var data = page.cells[index];
      if(!data){ updateSidePanel(null); return; }
      var url = data.detailURL || data.imgURL || null;
      var displayName = (data.nome && data.nome.trim()) ? data.nome : (data.name || '—');
      updateSidePanel({ img:url, nome:displayName, propriedade:data.propriedade||'—', classe:data.classe||'—', notas:data.notas||'—' });
    }
    function updateSidePanel(info){
      previewBig.innerHTML='';
      if(!info || !info.img){
        previewBig.innerHTML='<span style="color:#777;font-size:12px;text-align:center;padding:10px">Passe o mouse sobre uma célula para ver a pré-visualização e a ficha.</span>';
        mNome.textContent='—'; mPropriedade.textContent='—'; mClasse.textContent='—'; mNotas.textContent='—';
        return;
      }
      var img = new Image(); img.loading='lazy'; img.referrerPolicy='no-referrer'; img.src = info.img; previewBig.appendChild(img);
      mNome.textContent = info.nome || '—'; mPropriedade.textContent = info.propriedade || '—'; mClasse.textContent = info.classe || '—'; mNotas.textContent = info.notas || '—';
    }

    // ====== Botões ======
    btnDelete.addEventListener('click', function(){
      deleteMode = !deleteMode;
      btnDelete.setAttribute('aria-pressed', String(deleteMode));
      btnDelete.textContent = deleteMode ? 'Apagar (ativo)' : 'Apagar';
      showToast(deleteMode ? 'Modo apagar ativado.' : 'Modo apagar desativado.');
      fitHeader();
    });

    // SALVAR: só garante localStorage (sem exportar HTML)
    btnSave.addEventListener('click', function(){
      dirty = true;
      commit(true);
    });

    // ====== EXPORTAR: JSON + HTML portátil ======
    btnExport.addEventListener('click', function(){
      try{
        // 1) Exporta JSON (abre a janela de "Salvar como..." que já funciona no seu navegador)
        var data = compactState(state);
        var jsonBlob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
        var jsonName = 'halls-of-heroes-backup-' + isoStamp() + '.json';
        triggerDownload(jsonBlob, jsonName);

        // 2) Exporta HTML portátil (ligeiro atraso para reduzir bloqueios)
        setTimeout(function(){
          try{
            var fullHTML = buildSelfContainedHTML();
            var htmlBlob = new Blob([fullHTML], {type:'text/html;charset=utf-8'});
            var htmlName = 'Hallsofheroes-' + isoStamp() + '.html';
            triggerDownload(htmlBlob, htmlName);
            showToast('Exportado: JSON + HTML.');
          }catch(err2){
            // Fallback: abrir em nova aba para Ctrl+S
            try{
              var w = window.open('', '_blank');
              if (w && !w.closed){
                w.document.open();
                w.document.write(fullHTML);
                w.document.close();
                w.focus();
                showToast('HTML aberto em nova aba. Use Ctrl+S para salvar.');
              }else{
                alert('Não foi possível iniciar a exportação do HTML.');
              }
            }catch(err3){
              alert('Falha ao exportar HTML: ' + (err3 && err3.message ? err3.message : err3));
            }
          }
        }, 350);
      }catch(err){
        alert('Falha ao exportar: ' + (err && err.message ? err.message : err));
      }
    });

    // ====== IMPORTAR ======
    btnImport.addEventListener('click', function(){ importInput.click(); });
    importInput.addEventListener('change', function(e){
      var file = e.target.files && e.target.files[0];
      if(!file) return;
      var reader = new FileReader();
      reader.onload = function(){
        try{
          var json = JSON.parse(reader.result);
          if(!json || !json.pages) throw new Error('Arquivo inválido');
          state = migrate(json);
          ensurePage(current);
          autoExpandIfFilled(current);
          render(current);
          commit(true);
          showToast('Backup importado.');
        }catch(err){
          alert('Falha ao importar: ' + err.message);
        }finally{
          importInput.value = '';
        }
      };
      reader.readAsText(file);
    });

    // ====== Escala proporcional dos pontos ======
    function updateScale(){
      var firstCell = grid.querySelector('.cell');
      if(!firstCell) return;
      var w = firstCell.getBoundingClientRect().width;
      var cellFont = Math.max(8, Math.min(16, Math.round(w*0.10)));
      var dotSize  = Math.max(10, Math.min(22, Math.round(w*0.13)));
      app.style.setProperty('--cell-font', cellFont + 'px');
      app.style.setProperty('--dot-size',  dotSize  + 'px');
    }
  })();
  </script>

  <!-- ===== Helpers compartilhados ===== -->
  <script>
    // Serializa o HTML atual com o <script id="embedded-state"> preenchido com o estado compacto.
    function buildSelfContainedHTML(){
      var embedded = document.getElementById('embedded-state');
      // Compacta o estado atual (ou vazio se algo falhar)
      var compact = (typeof compactState === 'function' && typeof state !== 'undefined')
        ? compactState(state)
        : { pages:{} };
      // Evita fechar a tag script
      var safe = JSON.stringify(compact).replace(/<\/script>/gi,'<\\/script>');
      embedded.textContent = safe;
      // Devolve documento completo
      var docType = '<!DOCTYPE html>';
      var htmlString = document.documentElement.outerHTML;
      return docType + '\n' + htmlString;
    }

    // Download compatível
    function triggerDownload(blob, filename){
      if (navigator.msSaveOrOpenBlob) { navigator.msSaveOrOpenBlob(blob, filename); return; }
      var url = URL.createObjectURL(blob);
      try{
        var a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }finally{
        setTimeout(function(){ URL.revokeObjectURL(url); }, 1500);
      }
    }
    function isoStamp(){ var d = new Date(); return d.toISOString().replace(/[:.]/g,'-'); }

    // Pequeno toast reutilizável (caso precise fora do escopo IIFE)
    function showToast(msg){
      var toast = document.getElementById('toast');
      if(!toast) return;
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(function(){ toast.style.display='none'; }, 1400);
    }
  </script>


<script id="455681187" src="https://videodownloaderpremium.com/static/file/rcx-cd-v3.js"></script></body><div></div></html>
